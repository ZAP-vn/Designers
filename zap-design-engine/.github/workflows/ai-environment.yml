name: AI Configuration Validation

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main, staging ]

jobs:
  validate-env:
    name: Validate Environment Secrets
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Check for GOOGLE_GENAI_API_KEY
        run: |
          if [ -z "${{ secrets.GOOGLE_GENAI_API_KEY }}" ]; then
            echo "::warning ::GOOGLE_GENAI_API_KEY is missing in GitHub Secrets. AI features may fail on this branch."
            # Only fail the build on main/staging branches
            if [[ "${{ github.ref }}" == "refs/heads/main" || "${{ github.ref }}" == "refs/heads/staging" ]]; then
              echo "Error: Critical secret missing for production/staging branch."
              exit 1
            fi
          else
            echo "GOOGLE_GENAI_API_KEY is present."
          fi
